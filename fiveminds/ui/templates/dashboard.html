{% extends "base.html" %}

{% block title %}Dashboard - Five Minds{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Context Bar - Status indicator (smaller, calmer) -->
    <div class="top-header-bar">
        <div class="current-task-header">
            <div class="task-status-indicator">
                <span class="status-pill">
                    <span id="task-status-dot" class="status-dot idle"></span>
                    <span id="status-text">Idle</span>
                </span>
            </div>
            <div class="task-info">
                <p id="headmaster-action" class="current-task-title">HeadMaster idle â€” waiting for objective</p>
            </div>
            <div class="task-controls">
                <button id="stop-btn" class="btn btn-danger btn-small" style="display: none;">
                    Stop
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Overview Row -->
    <div class="stats-overview">
        <div class="stat-box">
            <div class="stat-content">
                <span id="stat-status" class="stat-value">Idle</span>
                <span class="stat-label">Status</span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-content">
                <span id="stat-runners" class="stat-value">0</span>
                <span class="stat-label">Active runners</span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-content">
                <span id="stat-tickets" class="stat-value">0 / 0</span>
                <span class="stat-label">Tickets done</span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-content">
                <span id="stat-elapsed" class="stat-value">--:--</span>
                <span class="stat-label">Elapsed</span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-content-grid">
        <!-- Left Column: HeadMaster & Runners -->
        <div class="left-column">
            <!-- HeadMaster Activity -->
            <div class="card headmaster-card">
                <div class="card-header">
                    <h2>HeadMaster activity</h2>
                    <span id="headmaster-status" class="status-badge idle">Idle</span>
                </div>
                <div class="card-body">
                    <div id="headmaster-reasoning" class="reasoning-log">
                        <div class="reasoning-empty">
                            <p>HeadMaster is idle.</p>
                            <span class="empty-hint">Set an objective to begin planning.</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Runners -->
            <div class="card runners-card">
                <div class="card-header">
                    <h2>Runners</h2>
                    <span id="runners-count" class="badge">0 active</span>
                </div>
                <div class="card-body">
                    <div id="runners-list" class="runners-list">
                        <div class="runners-empty">No runners active</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Objective & Progress -->
        <div class="right-column">
            <!-- Current Objective - Primary Focus -->
            <div class="card objective-card">
                <div class="card-header">
                    <h2>Current objective</h2>
                </div>
                <div class="card-body">
                    <p id="objective-description" class="objective-text">No objective set</p>
                    <div class="objective-meta">
                        <span id="objective-requirements" class="meta-item">0 requirements</span>
                        <span id="objective-constraints" class="meta-item">0 constraints</span>
                    </div>
                    <div class="objective-cta" id="objective-cta">
                        <button class="btn btn-primary" onclick="focusObjectiveInput()">Set objective</button>
                    </div>
                </div>
            </div>

            <!-- Progress Timeline -->
            <div class="card progress-card">
                <div class="card-header">
                    <h2>Progress</h2>
                    <span id="progress-count" class="badge">0 events</span>
                </div>
                <div class="card-body">
                    <div id="progress-timeline" class="timeline">
                        <div class="timeline-empty">Waiting for activity...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tickets Section -->
    <div class="tickets-section card">
        <div class="card-header">
            <h2>Tickets</h2>
            <div class="ticket-stats">
                <span class="stat completed" id="tickets-completed">0 completed</span>
                <span class="stat in-progress" id="tickets-in-progress">0 in progress</span>
                <span class="stat pending" id="tickets-pending">0 pending</span>
                <span class="stat failed" id="tickets-failed">0 failed</span>
            </div>
        </div>
        <div class="card-body">
            <div id="tickets-grid" class="tickets-grid">
                <div class="tickets-empty">No tickets created yet</div>
            </div>
        </div>
    </div>

    <!-- Final Summary Section (shown when completed) -->
    <div id="final-summary-section" class="final-summary-section" style="display: none;">
        <div class="card final-summary-card">
            <div class="card-header">
                <h2>Execution complete</h2>
            </div>
            <div class="card-body">
                <pre id="final-summary-content" class="final-summary-content"></pre>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
