{% extends "base.html" %}

{% block title %}Dashboard - Five Minds{% endblock %}

{% block content %}
<!-- Welcome Modal (shown when no objective is set) -->
<div id="welcome-modal" class="modal">
    <div class="modal-content welcome-modal-content">
        <div class="welcome-header">
            <h1>ğŸ§  Welcome to Five Minds</h1>
            <p>An agentic, repo-native AI dev system</p>
        </div>
        
        <form id="objective-form" class="objective-form">
            <div class="form-group">
                <label for="objective-description">What do you want to accomplish? *</label>
                <textarea 
                    id="objective-description" 
                    name="description" 
                    rows="3" 
                    placeholder="e.g., Add user authentication to the web app"
                    required
                ></textarea>
            </div>
            
            <div class="form-group">
                <label for="objective-requirements">Requirements (one per line)</label>
                <textarea 
                    id="objective-requirements" 
                    name="requirements" 
                    rows="4" 
                    placeholder="e.g.,&#10;Implement login/logout endpoints&#10;Add user model&#10;Create authentication middleware"
                ></textarea>
                <small>Leave empty to use the objective as the main requirement</small>
            </div>
            
            <div class="form-group">
                <label for="objective-constraints">Constraints (one per line)</label>
                <textarea 
                    id="objective-constraints" 
                    name="constraints" 
                    rows="3" 
                    placeholder="e.g.,&#10;Use Python 3.8+&#10;Follow PEP 8 guidelines&#10;Maintain backward compatibility"
                ></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">
                    ğŸš€ Start Five Minds
                </button>
            </div>
        </form>
    </div>
</div>

<div class="dashboard">
    <!-- Top Header Bar - Current Task Title -->
    <div class="top-header-bar">
        <div class="current-task-header">
            <div class="task-status-indicator">
                <span id="task-status-dot" class="status-dot idle"></span>
            </div>
            <div class="task-info">
                <h1 id="current-task-title" class="current-task-title">Waiting for objective...</h1>
                <p id="headmaster-action" class="headmaster-action">HeadMaster is idle</p>
            </div>
            <div class="task-controls">
                <button id="stop-btn" class="btn btn-danger" style="display: none;">
                    â¹ Stop Execution
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Overview Row -->
    <div class="stats-overview">
        <div class="stat-box">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-content">
                <span id="stat-status" class="stat-value">Idle</span>
                <span class="stat-label">Status</span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-icon">ğŸƒ</div>
            <div class="stat-content">
                <span id="stat-runners" class="stat-value">0</span>
                <span class="stat-label">Active Runners</span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-icon">ğŸ«</div>
            <div class="stat-content">
                <span id="stat-tickets" class="stat-value">0 / 0</span>
                <span class="stat-label">Tickets Done</span>
            </div>
        </div>
        <div class="stat-box">
            <div class="stat-icon">â±ï¸</div>
            <div class="stat-content">
                <span id="stat-elapsed" class="stat-value">--:--</span>
                <span class="stat-label">Elapsed</span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-content-grid">
        <!-- Left Column: HeadMaster & Runners -->
        <div class="left-column">
            <!-- HeadMaster Activity -->
            <div class="card headmaster-card">
                <div class="card-header">
                    <h2><span class="icon">ğŸ“</span> HeadMaster Activity</h2>
                    <span id="headmaster-status" class="status-badge idle">Idle</span>
                </div>
                <div class="card-body">
                    <div id="headmaster-reasoning" class="reasoning-log">
                        <div class="reasoning-empty">HeadMaster is waiting for an objective...</div>
                    </div>
                </div>
            </div>

            <!-- Active Runners -->
            <div class="card runners-card">
                <div class="card-header">
                    <h2><span class="icon">ğŸƒ</span> Runners</h2>
                    <span id="runners-count" class="badge">0 active</span>
                </div>
                <div class="card-body">
                    <div id="runners-list" class="runners-list">
                        <div class="runners-empty">No runners active</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Objective & Progress -->
        <div class="right-column">
            <!-- Current Objective -->
            <div class="card objective-card">
                <div class="card-header">
                    <h2><span class="icon">ğŸ¯</span> Current Objective</h2>
                </div>
                <div class="card-body">
                    <p id="objective-description" class="objective-text">No objective set</p>
                    <div class="objective-meta">
                        <span id="objective-requirements" class="meta-item">ğŸ“‹ 0 requirements</span>
                        <span id="objective-constraints" class="meta-item">âš ï¸ 0 constraints</span>
                    </div>
                </div>
            </div>

            <!-- Progress Timeline -->
            <div class="card progress-card">
                <div class="card-header">
                    <h2><span class="icon">ğŸ“Š</span> Progress</h2>
                    <span id="progress-count" class="badge">0 events</span>
                </div>
                <div class="card-body">
                    <div id="progress-timeline" class="timeline">
                        <div class="timeline-empty">Waiting for activity...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tickets Section -->
    <div class="tickets-section card">
        <div class="card-header">
            <h2><span class="icon">ğŸ«</span> Tickets</h2>
            <div class="ticket-stats">
                <span class="stat completed" id="tickets-completed">0 completed</span>
                <span class="stat in-progress" id="tickets-in-progress">0 in progress</span>
                <span class="stat pending" id="tickets-pending">0 pending</span>
                <span class="stat failed" id="tickets-failed">0 failed</span>
            </div>
        </div>
        <div class="card-body">
            <div id="tickets-grid" class="tickets-grid">
                <div class="tickets-empty">No tickets created yet</div>
            </div>
        </div>
    </div>

    <!-- Final Summary Section (shown when completed) -->
    <div id="final-summary-section" class="final-summary-section" style="display: none;">
        <div class="card final-summary-card">
            <div class="card-header">
                <h2><span class="icon">âœ…</span> Execution Complete</h2>
            </div>
            <div class="card-body">
                <pre id="final-summary-content" class="final-summary-content"></pre>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
