{% extends "base.html" %}

{% block title %}Review - Five Minds{% endblock %}

{% block content %}
<div class="review-page">
    <div class="page-header">
        <h1>Review</h1>
        <p class="subtitle">Review results and manage follow-up tickets</p>
    </div>

    <!-- Review Summary -->
    <div class="review-summary card">
        <div class="card-header">
            <h2>Summary</h2>
        </div>
        <div class="card-body">
            <div class="summary-grid">
                <div class="summary-item approved">
                    <span class="summary-value" id="approved-count">0</span>
                    <span class="summary-label">Approved</span>
                </div>
                <div class="summary-item rejected">
                    <span class="summary-value" id="rejected-count">0</span>
                    <span class="summary-label">Rejected</span>
                </div>
                <div class="summary-item pending">
                    <span class="summary-value" id="pending-count">0</span>
                    <span class="summary-label">Pending</span>
                </div>
                <div class="summary-item alignment">
                    <span class="summary-value" id="avg-alignment">0%</span>
                    <span class="summary-label">Avg alignment</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews List -->
    <div class="reviews-list card">
        <div class="card-header">
            <h2>Reviews</h2>
            <div class="filter-controls">
                <select id="review-filter" class="filter-select">
                    <option value="all">All reviews</option>
                    <option value="approved">Approved only</option>
                    <option value="rejected">Rejected only</option>
                </select>
            </div>
        </div>
        <div class="card-body">
            <div id="reviews-container" class="reviews-container">
                <div class="reviews-empty">
                    <p>No reviews yet</p>
                    <span class="empty-hint">Reviews will appear here after runner execution completes.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Follow-up Tickets -->
    <div class="follow-ups card">
        <div class="card-header">
            <h2>Follow-up tickets</h2>
            <button id="create-followup-btn" class="btn btn-primary btn-small" onclick="openFollowUpModal()">
                Create follow-up
            </button>
        </div>
        <div class="card-body">
            <div id="followups-container" class="followups-container">
                <div class="followups-empty">
                    <p>No follow-up tickets created</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Follow-up Modal -->
<div id="followup-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create follow-up ticket</h2>
            <button class="modal-close" onclick="closeFollowUpModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="followup-form">
                <div class="form-group">
                    <label for="followup-title">Title</label>
                    <input type="text" id="followup-title" required placeholder="Enter ticket title">
                </div>
                <div class="form-group">
                    <label for="followup-description">Description</label>
                    <textarea id="followup-description" required placeholder="Enter description"></textarea>
                </div>
                <div class="form-group">
                    <label for="followup-priority">Priority</label>
                    <select id="followup-priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="followup-parent">Parent ticket</label>
                    <select id="followup-parent">
                        <option value="">None</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeFollowUpModal()">Cancel</button>
            <button class="btn btn-primary" onclick="submitFollowUp()">Create ticket</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/review.js') }}"></script>
{% endblock %}
